---
import Base from "@layouts/Base.astro";
import Footer from "@components/sections/Footer.astro";
import NavigationBar from "@components/sections/NavigationBar.astro";

import * as landingPage from "../content/_one-offs/landing-page.md";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import type { Verse } from "@utils/getScriptureText";

const {
	Content,
	frontmatter: { title, description: tagline },
} = landingPage;

const seasons = await Promise.all(
	(await getCollection("seasons")).map(async (s) => [
		s,
		(await getCollection("episodes", (e) => e.data.season.id === s.id)).flatMap(e => e.data.references),
	]),
);

type Season = CollectionEntry<"seasons">;
---

<Base title={title + " | " + tagline}>
	<NavigationBar />
	<main class="u-guttered">
		<h1>{title}</h1>
		<Content />
		<h2>Seasons</h2>
		<ol>
			{
				seasons.map(([s, v]: [Season, Verse[]]) => (
					<li>
						<h3><a href={`/${s.id}`}>{s.data.title}</a></h3>
						<p>{v.length} Reference{v.length === 1 ? '' : 's'}</p>
					</li>
				))
			}
		</ol>
	</main>
	<Footer />
</Base>
